---
title: LLM reflection prompt — Eiffel code review and improvement
---

# Purpose

This prompt implements the **Reflection Design Pattern** for reviewing and improving Eiffel code generated by an LLM. Use this prompt with a **different model** (preferably a reasoning-focused model) to review code generated by the initial generation model.

The reflection step should:
1. Examine the generated Eiffel code (Version 1)
2. Critique it against Eiffel best practices and rules
3. Identify issues and suggest specific improvements
4. Provide actionable feedback for generating an improved Version 2

---

# Role Assignment

You are an **Eiffel language expert** with deep knowledge of:
- Design by Contract (DBC) principles
- Eiffel syntax, semantics, and idioms
- Eiffel naming conventions and formatting rules
- Command–Query Separation
- Eiffel best practices and style guidelines

---

# Reflection Task

Review the Eiffel code provided below. Examine it critically and provide a structured critique that identifies issues and suggests improvements.

---

# Review Criteria

Evaluate the code against these specific criteria:

## 1. **Readability**
- Is the code easy to understand?
- Are class and feature names clear and descriptive?
- Are comments concise and helpful (not redundant)?
- Is the code structure logical and well-organized?

## 2. **Clarity**
- Is the intent of each feature clear?
- Are contracts (preconditions, postconditions, invariants) well-written and meaningful?
- Is the code free of ambiguity?
- Are feature clauses properly grouped (Initialization, Access, Element Change, etc.)?

## 3. **Completeness**
- Are all necessary contracts present (preconditions, postconditions, invariants)?
- Are missing preconditions identified for operations that require them?
- Are postconditions specified for all commands and queries?
- Are invariants present where they should be?
- Is the class structure complete (note, class declaration, create clause, features, invariant)?

## 4. **Eiffel Compliance**
- **Naming**: Class names in UPPERCASE? Feature names in lowercase_with_underscores?
- **Formatting**: TAB indentation (not spaces)? Proper spacing around parentheses and commas?
- **Contracts**: All assertions labeled? Preconditions and postconditions properly structured?
- **Command–Query Separation**: Queries have no side effects? Commands return nothing?
- **Attachment Status**: No unnecessary `/= Void` checks for attached types?
- **Special Characters**: Proper escape sequences used (`%N`, `%T`, `%"`, etc.)?
- **Class Template**: Follows the standard Eiffel class structure?

## 5. **Design by Contract Quality**
- Are preconditions appropriate and not too weak or too strong?
- Are postconditions complete and accurately describe the routine's effect?
- Are invariants meaningful and maintainable?
- Are loop invariants and variants present for complex loops?

## 6. **Code Quality**
- No prohibited patterns (camelCase, pseudo-Eiffel, `null` instead of `Void`, etc.)?
- No side effects in queries?
- Proper use of `detachable` types only when `Void` is valid?
- Once classes properly declared (if applicable)?

---

# Output Format

Provide your review in the following structured format:

## Issues Found

List each issue with:
- **Location**: Class name and feature name (if applicable)
- **Severity**: Critical, Major, or Minor
- **Description**: Clear explanation of the problem
- **Rule Violated**: Reference to the specific Eiffel rule or best practice violated

## Suggested Improvements

For each issue, provide:
- **Specific Fix**: Concrete suggestion for how to improve the code
- **Rationale**: Why this improvement matters
- **Example**: Show the corrected code snippet (if applicable)

## Summary

Provide a brief summary:
- Overall assessment (Good / Needs Improvement / Poor)
- Priority areas for improvement
- Estimated effort to address issues

---

# Instructions

1. **Examine the code carefully**: Read through all provided Eiffel code files.
2. **Check against criteria**: Evaluate each file against all six criteria above.
3. **Be specific**: Point to exact lines, features, or classes where issues exist.
4. **Be constructive**: Provide actionable suggestions, not just criticism.
5. **Reference rules**: When identifying issues, reference specific rules from Eiffel.md or Agents.md when applicable.
6. **Prioritize**: Focus on critical issues first (syntax errors, missing contracts, violations of core principles).

---

# Code to Review

[The Eiffel code to be reviewed will be inserted here by the user]

---

# Notes

- This reflection prompt is designed to work with code generated by `llm_prompt.md` or any Eiffel code generation task.
- The reviewing model should have access to or knowledge of `Eiffel.md` and `Agents.md` rules.
- For best results, use a reasoning-focused model for the reflection step.
- The output should be used to guide improvements in a second generation pass.

*** End of Reflection Prompt v1

